<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>The STAGE Likelihood ‚Ä¢ stage</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="‚Äùimage/svg+xml‚Äù" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The STAGE Likelihood">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">stage</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/why-stage.html">Why STAGE?</a></li>
    <li><a class="dropdown-item" href="../articles/likelihood.html">The STAGE Likelihood</a></li>
    <li><a class="dropdown-item" href="../articles/fit-stage.html">Fitting STAGE</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://mc-stan.org">Stan</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/anhsmith/stage" aria-label="stage GitHub repository"><span class="fa fa-github"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://seathrough.science" aria-label="Sea Through Science website"><span class="fa fa-globe"></span> Sea Through Science</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>The STAGE Likelihood</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/anhsmith/stage/blob/master/vignettes/likelihood.Rmd" class="external-link"><code>vignettes/likelihood.Rmd</code></a></small>
      <div class="d-none name"><code>likelihood.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette describes the <strong>likelihood and
parameterisation</strong> used in the STAGE model.</p>
<p>STAGE is a <strong>hierarchical Bayesian generative model</strong>
designed to estimate a <strong>transition point</strong>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mn>50</mn></msub><annotation encoding="application/x-tex">m_{50}</annotation></semantics></math>
on variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
between two classes‚Äîfor example, the length at which individuals
transition from immature to mature. The model produces a posterior
distribution for key parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mn>50</mn></msub><annotation encoding="application/x-tex">m_{50}</annotation></semantics></math>,
representing the value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
at which the probabilities
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Pr</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Pr(y=0)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Pr</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Pr(y=1)</annotation></semantics></math>
are equal. The model can also be used to derive other useful quantities
(such as class probabilities
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Pr</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>‚à£</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Pr(y = 1 \mid x)</annotation></semantics></math>).</p>
<p>Conceptually, STAGE is a <strong>Bayesian generative
classifier</strong> for estimating a transition point (e.g.¬†length at
maturity). Each class is fit with an asymmetric
<strong>plateau‚ÄìGaussian</strong> density:</p>
<ul>
<li>the lower class has a <strong>uniform plateau</strong> followed by a
<strong>Gaussian tail down into the transition</strong>,<br>
</li>
<li>the higher class has a <strong>Gaussian tail up out of the
transition</strong> followed by a <strong>uniform plateau</strong>.</li>
</ul>
<p><img src="likelihood_files/figure-html/visualize-1.png" class="r-plt" width="576"></p>
<p>This construction focuses inference on the <strong>overlap
region</strong> and prevents distant observations (e.g.¬†very small
immatures, very large matures) from unduly influencing the transition
point.</p>
<p>The central idea is to model each class with a <strong>piecewise
density</strong> that combines a <strong>uniform plateau</strong> in
regions far from the transition, and a <strong>Gaussian tail</strong> in
the transition region. The left group
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y = 0</annotation></semantics></math>)
is modelled with a uniform on the left that begins at the lower
truncation value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>L</mi><annotation encoding="application/x-tex">L</annotation></semantics></math>.
The distribution remains flat until it approaches the transition range,
at which point the distribution declines according to a Gaussian. The
right group
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y = 1</annotation></semantics></math>)
is a mirror image of the left‚Äîit increases according to a Gaussian
distribution and then levels off to a uniform, terminating at the upper
truncation value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>U</mi><annotation encoding="application/x-tex">U</annotation></semantics></math>.</p>
<p>The model focuses inference on the <strong>transition zone</strong>,
where the values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
of the two classes overlap, and down-weights observations that are
biologically uninformative because they are far away from the transition
point.</p>
<p>The uniform‚ÄìGaussian pdf used here is adapted from a plateau proposal
distribution combining a uniform and two Gaussians described by Lau
&amp; Krumscheid <span class="citation">(2022)</span>.</p>
</div>
<div class="section level2">
<h2 id="model-summary">Model summary<a class="anchor" aria-label="anchor" href="#model-summary"></a>
</h2>
<p>We observe pairs
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>,</mo><msub><mi>y</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(x_i, y_i)</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">i = 1, \dots, N</annotation></semantics></math>,
where</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>i</mi></msub><annotation encoding="application/x-tex">x_i</annotation></semantics></math>
is a continuous covariate (e.g., length), truncated to an interval
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><mi>L</mi><mo>,</mo><mi>U</mi><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[L, U]</annotation></semantics></math>,
and<br>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>‚àà</mo><mo stretchy="false" form="prefix">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">y_i \in \{0, 1\}</annotation></semantics></math>
is a binary indicator of state (e.g., immature / mature).</li>
</ul>
<p>The model assumes that the distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
conditional on state is <strong>piecewise</strong>:</p>
<ul>
<li>For
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y = 0</annotation></semantics></math>
(immature individuals), the distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
is approximately <strong>uniform</strong> up to a point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\mu_0</annotation></semantics></math>,
after which it follows a <strong>Gaussian decay</strong>.</li>
<li>For
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y = 1</annotation></semantics></math>
(mature individuals), the distribution is <strong>Gaussian</strong>
below a point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\mu_1</annotation></semantics></math>,
and <strong>uniform</strong> above
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\mu_1</annotation></semantics></math>
up to the upper truncation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>U</mi><annotation encoding="application/x-tex">U</annotation></semantics></math>.</li>
</ul>
<p>The <strong>transition point</strong>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mn>50</mn></msub><annotation encoding="application/x-tex">m_{50}</annotation></semantics></math>
is defined as the value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
where the probability of observing either class is equal:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Pr</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>=</mo><mn>0</mn><mo>‚à£</mo><mi>x</mi><mo>=</mo><msub><mi>m</mi><mn>50</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>Pr</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>‚à£</mo><mi>x</mi><mo>=</mo><msub><mi>m</mi><mn>50</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\Pr(y = 0 \mid x = m_{50}) = \Pr(y = 1 \mid x = m_{50}).
</annotation></semantics></math></p>
<p>Additional parameters govern the <strong>width</strong> and
<strong>sharpness</strong> of the transition:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>
controls the distance between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\mu_0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\mu_1</annotation></semantics></math>
(the width of the transition region),</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÉ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
(denoted <code>sigma_x</code> in the Stan code) controls the spread
(standard deviation) of the Gaussian tails.</li>
</ul>
<p>By allowing different behaviours on either side of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mn>50</mn></msub><annotation encoding="application/x-tex">m_{50}</annotation></semantics></math>,
the model can capture <strong>asymmetric transition patterns</strong>:
the immature class can decline towards the transition at a different
rate than the mature class rises out of it.</p>
<p>This is particularly useful in settings where:</p>
<ul>
<li>the boundary between classes is <strong>not sharp</strong>,
and<br>
</li>
<li>the data exhibit <strong>gradual overlap</strong> between the two
classes.</li>
</ul>
</div>
<div class="section level2">
<h2 id="likelihood">Likelihood<a class="anchor" aria-label="anchor" href="#likelihood"></a>
</h2>
<p>The likelihood is built from two <strong>unnormalised log-density
functions</strong> for the two classes. We work on the log scale for
numerical stability and then subtract log-normalising constants to
obtain valid densities.</p>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>‚Ñì</mo><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\ell_0(x)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>‚Ñì</mo><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\ell_1(x)</annotation></semantics></math>
denote the unnormalised log-densities for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y = 0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y = 1</annotation></semantics></math>,
respectively. The corresponding (unnormalised) densities are
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>f</mi><mo accent="true">ÃÉ</mo></mover><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>exp</mo><mo stretchy="false" form="prefix">{</mo><msub><mo>‚Ñì</mo><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\tilde f_k(x) = \exp\{\ell_k(x)\}</annotation></semantics></math>.</p>
<p>We restrict attention to the truncated interval
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><mi>L</mi><mo>,</mo><mi>U</mi><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[L, U]</annotation></semantics></math>;
the densities are zero outside this range.</p>
<div class="section level3">
<h3 id="lower-class-y-0">Lower class
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y = 0</annotation></semantics></math>)<a class="anchor" aria-label="anchor" href="#lower-class-y-0"></a>
</h3>
<p>For
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y_i = 0</annotation></semantics></math>,
the unnormalised piecewise log-density is</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>‚Ñì</mo><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>‚à£</mo><msub><mi>Œº</mi><mn>0</mn></msub><mo>,</mo><mi>œÉ</mi><mo>,</mo><mi>L</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mn>0</mn></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><mi>L</mi><mo>‚â§</mo><msub><mi>x</mi><mi>i</mi></msub><mo>‚â§</mo><msub><mi>Œº</mi><mn>0</mn></msub><mo>,</mo></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mo>‚àí</mo><mfrac displaystyle="true"><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>‚àí</mo><msub><mi>Œº</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mrow><mn>2</mn><msup><mi>œÉ</mi><mn>2</mn></msup></mrow></mfrac></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>x</mi><mi>i</mi></msub><mo>&gt;</mo><msub><mi>Œº</mi><mn>0</mn></msub><mi>.</mi></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
\ell_0(x_i \mid \mu_0, \sigma, L) =
\begin{cases}
0 &amp; \text{if } L \leq x_i \leq \mu_0, \\
-\dfrac{(x_i - \mu_0)^2}{2\sigma^2} &amp; \text{if } x_i &gt; \mu_0 .
\end{cases}
</annotation></semantics></math></p>
<p>Here:</p>
<ul>
<li>the plateau region
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><mi>L</mi><mo>,</mo><msub><mi>Œº</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[L, \mu_0]</annotation></semantics></math>
has constant log-density 0 (density 1),</li>
<li>the tail region
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>&gt;</mo><msub><mi>Œº</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_i &gt; \mu_0</annotation></semantics></math>
decays according to a Gaussian kernel.</li>
</ul>
<p>Any constant could be added to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>‚Ñì</mo><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚ãÖ</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\ell_0(\cdot)</annotation></semantics></math>
without changing the posterior; we fix the plateau at 0 so that the
plateau density is 1 after exponentiation.</p>
</div>
<div class="section level3">
<h3 id="higher-class-y-1">Higher class
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y = 1</annotation></semantics></math>)<a class="anchor" aria-label="anchor" href="#higher-class-y-1"></a>
</h3>
<p>For
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y_i = 1</annotation></semantics></math>,
the unnormalised log-density is</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>‚Ñì</mo><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>‚à£</mo><msub><mi>Œº</mi><mn>1</mn></msub><mo>,</mo><mi>œÉ</mi><mo>,</mo><mi>U</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mo>‚àí</mo><mfrac displaystyle="true"><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo>‚àí</mo><msub><mi>Œº</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mrow><mn>2</mn><msup><mi>œÉ</mi><mn>2</mn></msup></mrow></mfrac></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>x</mi><mi>i</mi></msub><mo>&lt;</mo><msub><mi>Œº</mi><mn>1</mn></msub><mo>,</mo></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>0</mn></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>Œº</mi><mn>1</mn></msub><mo>‚â§</mo><msub><mi>x</mi><mi>i</mi></msub><mo>‚â§</mo><mi>U</mi><mi>.</mi></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
\ell_1(x_i \mid \mu_1, \sigma, U) =
\begin{cases}
-\dfrac{(x_i - \mu_1)^2}{2\sigma^2} &amp; \text{if } x_i &lt; \mu_1, \\
0 &amp; \text{if } \mu_1 \leq x_i \leq U .
\end{cases}
</annotation></semantics></math></p>
<p>Now:</p>
<ul>
<li>the Gaussian tail is <strong>below</strong>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\mu_1</annotation></semantics></math>,
and<br>
</li>
<li>the plateau covers the upper region
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Œº</mi><mn>1</mn></msub><mo>,</mo><mi>U</mi><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[\mu_1, U]</annotation></semantics></math>.</li>
</ul>
<p>In both cases we have a <strong>plateau‚ÄìGaussian</strong> shape: a
flat density where the class ‚Äúdominates‚Äù and a Gaussian tail in the
transition region where the other class is present.</p>
</div>
<div class="section level3">
<h3 id="normalisation-constants">Normalisation constants<a class="anchor" aria-label="anchor" href="#normalisation-constants"></a>
</h3>
<p>To convert
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>f</mi><mo accent="true">ÃÉ</mo></mover><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>exp</mo><mo stretchy="false" form="prefix">{</mo><msub><mo>‚Ñì</mo><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\tilde f_k(x) = \exp\{\ell_k(x)\}</annotation></semantics></math>
into proper probability density functions on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><mi>L</mi><mo>,</mo><mi>U</mi><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[L, U]</annotation></semantics></math>,
we divide by constants
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>C</mi><mn>0</mn></msub><annotation encoding="application/x-tex">C_0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>C</mi><mn>1</mn></msub><annotation encoding="application/x-tex">C_1</annotation></semantics></math>
chosen so that the densities integrate to 1.</p>
<p>For the immature class
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y = 0</annotation></semantics></math>):</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mn>0</mn></msub><mo>=</mo><msubsup><mo>‚à´</mo><mi>L</mi><msub><mi>Œº</mi><mn>0</mn></msub></msubsup><mn>1</mn><mspace width="0.167em"></mspace><mi>d</mi><mi>x</mi><mo>+</mo><msubsup><mo>‚à´</mo><msub><mi>Œº</mi><mn>0</mn></msub><mi>‚àû</mi></msubsup><mfrac><mn>1</mn><mrow><msqrt><mrow><mn>2</mn><mi>œÄ</mi></mrow></msqrt><mi>œÉ</mi></mrow></mfrac><mo>exp</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚àí</mo><mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>‚àí</mo><msub><mi>Œº</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mrow><mn>2</mn><msup><mi>œÉ</mi><mn>2</mn></msup></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>x</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mn>0</mn></msub><mo>‚àí</mo><mi>L</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mfrac><mrow><msqrt><mrow><mn>2</mn><mi>œÄ</mi></mrow></msqrt><mspace width="0.167em"></mspace><mi>œÉ</mi></mrow><mn>2</mn></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">
C_0
= \int_L^{\mu_0} 1 \, dx
  + \int_{\mu_0}^{\infty}
    \frac{1}{\sqrt{2\pi}\sigma} \exp\!\left(
      -\frac{(x - \mu_0)^2}{2\sigma^2}
    \right) dx
= (\mu_0 - L) + \frac{\sqrt{2\pi}\,\sigma}{2}.
</annotation></semantics></math></p>
<p>For the mature class
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y = 1</annotation></semantics></math>):</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mn>1</mn></msub><mo>=</mo><msubsup><mo>‚à´</mo><mrow><mo>‚àí</mo><mi>‚àû</mi></mrow><msub><mi>Œº</mi><mn>1</mn></msub></msubsup><mfrac><mn>1</mn><mrow><msqrt><mrow><mn>2</mn><mi>œÄ</mi></mrow></msqrt><mi>œÉ</mi></mrow></mfrac><mo>exp</mo><mspace width="-0.167em"></mspace><mrow><mo stretchy="true" form="prefix">(</mo><mo>‚àí</mo><mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>‚àí</mo><msub><mi>Œº</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mrow><mn>2</mn><msup><mi>œÉ</mi><mn>2</mn></msup></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mi>x</mi><mo>+</mo><msubsup><mo>‚à´</mo><msub><mi>Œº</mi><mn>1</mn></msub><mi>U</mi></msubsup><mn>1</mn><mspace width="0.167em"></mspace><mi>d</mi><mi>x</mi><mo>=</mo><mfrac><mrow><msqrt><mrow><mn>2</mn><mi>œÄ</mi></mrow></msqrt><mspace width="0.167em"></mspace><mi>œÉ</mi></mrow><mn>2</mn></mfrac><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>U</mi><mo>‚àí</mo><msub><mi>Œº</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
C_1
= \int_{-\infty}^{\mu_1}
    \frac{1}{\sqrt{2\pi}\sigma} \exp\!\left(
      -\frac{(x - \mu_1)^2}{2\sigma^2}
    \right) dx
  + \int_{\mu_1}^{U} 1 \, dx
= \frac{\sqrt{2\pi}\,\sigma}{2} + (U - \mu_1).
</annotation></semantics></math></p>
<p>Intuitively:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Œº</mi><mn>0</mn></msub><mo>‚àí</mo><mi>L</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\mu_0 - L)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>U</mi><mo>‚àí</mo><msub><mi>Œº</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(U - \mu_1)</annotation></semantics></math>
are the <strong>widths of the uniform plateaus</strong>,<br>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mrow><mn>2</mn><mi>œÄ</mi></mrow></msqrt><mspace width="0.167em"></mspace><mi>œÉ</mi><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">\sqrt{2\pi}\,\sigma / 2</annotation></semantics></math>
is the <strong>contribution from the half-Gaussian tail</strong>.</li>
</ul>
<p>The corresponding <strong>log-likelihood contribution</strong> for
observation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
is</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><msub><mi>‚Ñí</mi><mi>i</mi></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><msub><mo>‚Ñì</mo><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mo>log</mo><msub><mi>C</mi><mn>0</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn><mo>,</mo></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><msub><mo>‚Ñì</mo><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mo>log</mo><msub><mi>C</mi><mn>1</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">if </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>y</mi><mi>i</mi></msub><mo>=</mo><mn>1</mn><mi>.</mi></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
\log \mathcal{L}_i =
\begin{cases}
\ell_0(x_i) - \log C_0 &amp; \text{if } y_i = 0, \\
\ell_1(x_i) - \log C_1 &amp; \text{if } y_i = 1.
\end{cases}
</annotation></semantics></math></p>
<p>Summing over all observations,</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo>‚à£</mo><msub><mi>m</mi><mn>50</mn></msub><mo>,</mo><mi>d</mi><mo>,</mo><mi>œÉ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munderover><mo>‚àë</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mo minsize="1.2" maxsize="1.2" stretchy="false" form="prefix">[</mo><msub><mo>‚Ñì</mo><msub><mi>y</mi><mi>i</mi></msub></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><mo>log</mo><msub><mi>C</mi><msub><mi>y</mi><mi>i</mi></msub></msub><mo minsize="1.2" maxsize="1.2" stretchy="false" form="postfix">]</mo><mo>,</mo></mrow><annotation encoding="application/x-tex">
\log p(x, y \mid m_{50}, d, \sigma)
=
\sum_{i=1}^{N}
\big[
  \ell_{y_i}(x_i) - \log C_{y_i}
\big],
</annotation></semantics></math></p>
<p>which is exactly the likelihood implemented in the Stan code used by
<code><a href="../reference/fit_stage.html">fit_stage()</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="prior-specification">Prior specification<a class="anchor" aria-label="anchor" href="#prior-specification"></a>
</h2>
<p>The priors reflect prior beliefs about plausible transition points
and transition widths in typical length-at-maturity problems. In
practice, these are <strong>defaults</strong> that should be adapted to
the scale of the data and prior biological knowledge.</p>
<p>By default, STAGE uses weakly informative normal priors:</p>
<ul>
<li>
<strong>Transition point</strong>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mn>50</mn></msub><annotation encoding="application/x-tex">m_{50}</annotation></semantics></math>:</li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mn>50</mn></msub><mo>‚àº</mo><mi>ùí©</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1300</mn><mo>,</mo><mn>50</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
m_{50} \sim \mathcal{N}(1300, 50),
</annotation></semantics></math></p>
<p>which centres the transition around 1300 (mm) with moderate
uncertainty.</p>
<ul>
<li>
<strong>Transition width</strong>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>:</li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>‚àº</mo><mi>ùí©</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>100</mn><mo>,</mo><mn>100</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
d \sim \mathcal{N}(100, 100),
</annotation></semantics></math></p>
<p>which allows the width of the overlap region to vary around 100 units
with a wide spread. Note that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>
is the distance between the class-specific Gaussian centres.</p>
<ul>
<li>
<strong>Gaussian spread</strong>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÉ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
(Stan parameter <code>sigma_x</code>):</li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>œÉ</mi><mo>‚àº</mo><mi>ùí©</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>100</mn><mo>,</mo><mn>50</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\sigma \sim \mathcal{N}(100, 50),
</annotation></semantics></math></p>
<p>representing prior beliefs about the scale of variability in the
transition tails.</p>
<p>In practice, you should adapt these priors to your scale (e.g.,
lengths, ages) and prior biological knowledge. The STAGE implementation
allows you to pass in hyperparameters via helper functions such as
<code><a href="../reference/stage_priors.html">stage_priors()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="transformed-parameters">Transformed parameters<a class="anchor" aria-label="anchor" href="#transformed-parameters"></a>
</h2>
<p>The Gaussian ‚Äúcentres‚Äù for the two classes are defined in terms of
the transition point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mn>50</mn></msub><annotation encoding="application/x-tex">m_{50}</annotation></semantics></math>
and the width parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œº</mi><mn>0</mn></msub><mo>=</mo><msub><mi>m</mi><mn>50</mn></msub><mo>‚àí</mo><mfrac><mi>d</mi><mn>2</mn></mfrac><mo>,</mo><mspace width="2.0em"></mspace><msub><mi>Œº</mi><mn>1</mn></msub><mo>=</mo><msub><mi>m</mi><mn>50</mn></msub><mo>+</mo><mfrac><mi>d</mi><mn>2</mn></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">
\mu_0 = m_{50} - \frac{d}{2}, \qquad
\mu_1 = m_{50} + \frac{d}{2}.
</annotation></semantics></math></p>
<p>Thus:</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>
controls the <strong>distance</strong> between the immature and mature
Gaussian means,<br>
</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mn>50</mn></msub><annotation encoding="application/x-tex">m_{50}</annotation></semantics></math>
remains the <strong>midpoint</strong> between them.</li>
</ul>
<p>This is convenient both conceptually and computationally: it allows
the model to focus directly on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mn>50</mn></msub><annotation encoding="application/x-tex">m_{50}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>,
which are often the primary scientific targets, while
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\mu_0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\mu_1</annotation></semantics></math>
are derived quantities.</p>
</div>
<div class="section level2">
<h2 id="from-class-densities-to-class-probabilities-bayes-rule">From class densities to class probabilities (Bayes rule)<a class="anchor" aria-label="anchor" href="#from-class-densities-to-class-probabilities-bayes-rule"></a>
</h2>
<p>The likelihood above defines the <strong>class-conditional
densities</strong><br><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>‚à£</mo><mi>y</mi><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f_0(x) = p(x \mid y = 0)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>‚à£</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f_1(x) = p(x \mid y = 1)</annotation></semantics></math>
on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">[</mo><mi>L</mi><mo>,</mo><mi>U</mi><mo stretchy="true" form="postfix">]</mo></mrow><annotation encoding="application/x-tex">[L, U]</annotation></semantics></math>,
obtained by normalising the unnormalised densities
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>f</mi><mo accent="true">ÃÉ</mo></mover><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>exp</mo><mo stretchy="false" form="prefix">{</mo><msub><mo>‚Ñì</mo><mi>k</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\tilde f_k(x) = \exp\{\ell_k(x)\}</annotation></semantics></math>
with the constants
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>C</mi><mi>k</mi></msub><annotation encoding="application/x-tex">C_k</annotation></semantics></math>.</p>
<p>To obtain the probability that an individual with a particular
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
value is in the higher class
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y = 1</annotation></semantics></math>),
we use Bayes rule:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Pr</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>‚à£</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><msub><mi>œÄ</mi><mn>1</mn></msub><msub><mi>f</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><msub><mi>œÄ</mi><mn>0</mn></msub><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>œÄ</mi><mn>1</mn></msub><msub><mi>f</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>,</mo></mrow><annotation encoding="application/x-tex">
\Pr(y = 1 \mid x)
= \frac{\pi_1 f_1(x)}{\pi_0 f_0(x) + \pi_1 f_1(x)},
</annotation></semantics></math></p>
<p>and similarly</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Pr</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>=</mo><mn>0</mn><mo>‚à£</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><msub><mi>œÄ</mi><mn>0</mn></msub><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><msub><mi>œÄ</mi><mn>0</mn></msub><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>œÄ</mi><mn>1</mn></msub><msub><mi>f</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>,</mo></mrow><annotation encoding="application/x-tex">
\Pr(y = 0 \mid x)
= \frac{\pi_0 f_0(x)}{\pi_0 f_0(x) + \pi_1 f_1(x)},
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œÄ</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\pi_0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œÄ</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\pi_1</annotation></semantics></math>
are the prior class probabilities<br>
(e.g., prior probabilities of being immature or mature <em>before</em>
seeing
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>).</p>
<p>In many applications, such as estimating length-at-maturity, we are
interested in a transition point that is <strong>not driven by sample
sizes or prevalence</strong>, so it is natural to use <strong>equal
class priors</strong>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>œÄ</mi><mn>0</mn></msub><mo>=</mo><msub><mi>œÄ</mi><mn>1</mn></msub><mo>=</mo><mn>1</mn><mi>/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">\pi_0 = \pi_1 = 1/2</annotation></semantics></math>.
In that case, Bayes rule simplifies to</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Pr</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>‚à£</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><msub><mi>f</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>f</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>,</mo><mspace width="2.0em"></mspace><mo>Pr</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>=</mo><mn>0</mn><mo>‚à£</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>f</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">
\Pr(y = 1 \mid x)
= \frac{f_1(x)}{f_0(x) + f_1(x)}, \qquad
\Pr(y = 0 \mid x)
= \frac{f_0(x)}{f_0(x) + f_1(x)}.
</annotation></semantics></math></p>
<p>These are the class probabilities that the STAGE model uses for
prediction, and they are what you see when you plot
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Pr</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>‚à£</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Pr(y = 1 \mid x)</annotation></semantics></math>
as a function of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>.</p>
<div class="section level3">
<h3 id="connection-to-m_50">Connection to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mn>50</mn></msub><annotation encoding="application/x-tex">m_{50}</annotation></semantics></math><a class="anchor" aria-label="anchor" href="#connection-to-m_50"></a>
</h3>
<p>By definition, the transition point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mn>50</mn></msub><annotation encoding="application/x-tex">m_{50}</annotation></semantics></math>
is the value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>
where the two classes are equally probable:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Pr</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>=</mo><mn>0</mn><mo>‚à£</mo><mi>x</mi><mo>=</mo><msub><mi>m</mi><mn>50</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>Pr</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>‚à£</mo><mi>x</mi><mo>=</mo><msub><mi>m</mi><mn>50</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">
\Pr(y = 0 \mid x = m_{50}) = \Pr(y = 1 \mid x = m_{50}) = \frac{1}{2}.
</annotation></semantics></math></p>
<p>Using Bayes rule with equal class priors, this equality is equivalent
to</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><msub><mi>f</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>m</mi><mn>50</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>m</mi><mn>50</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>f</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>m</mi><mn>50</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>=</mo><mfrac><mrow><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>m</mi><mn>50</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>m</mi><mn>50</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>f</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>m</mi><mn>50</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mspace width="1.0em"></mspace><mo>‚áî</mo><mspace width="1.0em"></mspace><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>m</mi><mn>50</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>f</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>m</mi><mn>50</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\frac{f_1(m_{50})}{f_0(m_{50}) + f_1(m_{50})}
=
\frac{f_0(m_{50})}{f_0(m_{50}) + f_1(m_{50})}
\quad\Longleftrightarrow\quad
f_0(m_{50}) = f_1(m_{50}).
</annotation></semantics></math></p>
<p>Thus,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mn>50</mn></msub><annotation encoding="application/x-tex">m_{50}</annotation></semantics></math>
can be viewed in two equivalent ways:</p>
<ol style="list-style-type: decimal">
<li>As a <strong>model parameter</strong> that sets the midpoint between
the Gaussian centres
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mn>0</mn></msub><annotation encoding="application/x-tex">\mu_0</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\mu_1</annotation></semantics></math>
via<br><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Œº</mi><mn>0</mn></msub><mo>=</mo><msub><mi>m</mi><mn>50</mn></msub><mo>‚àí</mo><mfrac><mi>d</mi><mn>2</mn></mfrac><mo>,</mo><mspace width="2.0em"></mspace><msub><mi>Œº</mi><mn>1</mn></msub><mo>=</mo><msub><mi>m</mi><mn>50</mn></msub><mo>+</mo><mfrac><mi>d</mi><mn>2</mn></mfrac><mo>,</mo></mrow><annotation encoding="application/x-tex">
\mu_0 = m_{50} - \frac{d}{2}, \qquad
\mu_1 = m_{50} + \frac{d}{2},
</annotation></semantics></math>
</li>
<li>As the <strong>Bayes-optimal classifier cut-point</strong> where the
posterior class probabilities for immature and mature are both 0.5.</li>
</ol>
<p>In practice, the STAGE model samples
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mn>50</mn></msub><annotation encoding="application/x-tex">m_{50}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÉ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
from their posterior distribution. For any posterior draw, we can
compute
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Pr</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>‚à£</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Pr(y = 1 \mid x)</annotation></semantics></math>
via Bayes rule and verify that the point where this curve crosses 0.5
aligns with the sampled value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mn>50</mn></msub><annotation encoding="application/x-tex">m_{50}</annotation></semantics></math>.
This makes the interpretation of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mn>50</mn></msub><annotation encoding="application/x-tex">m_{50}</annotation></semantics></math>
as a ‚Äú50% maturity‚Äù transition point directly linked to the underlying
generative model and Bayes-optimal classifier.</p>
</div>
<div class="section level3">
<h3 id="visualising-a-single-stage-transition">Visualising a single STAGE transition<a class="anchor" aria-label="anchor" href="#visualising-a-single-stage-transition"></a>
</h3>
<p>We can visualise a simple STAGE configuration, showing:</p>
<ul>
<li>the immature and mature densities, and</li>
<li>the resulting transition probability
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Pr</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>=</mo><mn>1</mn><mo>‚à£</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Pr(y=1 \mid x)</annotation></semantics></math>.</li>
</ul>
<p><img src="likelihood_files/figure-html/visualize-likelihood-1.png" class="r-plt" width="576"></p>
</div>
</div>
<div class="section level2">
<h2 id="relationship-to-the-stage-implementation">Relationship to the <code>stage</code> implementation<a class="anchor" aria-label="anchor" href="#relationship-to-the-stage-implementation"></a>
</h2>
<p>In the <code>stage</code> package:</p>
<ul>
<li>The single-population model uses parameters <code>m50</code>,
<code>d</code>, and <code>sigma_x</code> that correspond to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mn>50</mn></msub><annotation encoding="application/x-tex">m_{50}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>œÉ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>
in this vignette.</li>
<li>The multi-population (hierarchical) model introduces
population-specific transition points
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mrow><mn>50</mn><mo>,</mo><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">m_{50, j}</annotation></semantics></math>
via a random-effects structure:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><msub><mn>50</mn><mrow><mtext mathvariant="normal">pop</mtext><mrow><mo stretchy="true" form="prefix">[</mo><mi>j</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow></msub><mo>=</mo><msub><mi>Œº</mi><mrow><mi>m</mi><mn>50</mn></mrow></msub><mo>+</mo><msub><mi>z</mi><mi>j</mi></msub><mspace width="0.167em"></mspace><msub><mi>œÉ</mi><mi>Œ±</mi></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">
m50_{\text{pop}[j]} = \mu_{m50} + z_j \, \sigma_\alpha,
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Œº</mi><mrow><mi>m</mi><mn>50</mn></mrow></msub><annotation encoding="application/x-tex">\mu_{m50}</annotation></semantics></math>
is the overall mean transition point,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>z</mi><mi>j</mi></msub><annotation encoding="application/x-tex">z_j</annotation></semantics></math>
are standard-normal effects, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>œÉ</mi><mi>Œ±</mi></msub><annotation encoding="application/x-tex">\sigma_\alpha</annotation></semantics></math>
is the population-level standard deviation.</li>
</ul>
<p>The Stan code used in <code><a href="../reference/fit_stage.html">fit_stage()</a></code> is a direct
implementation of the likelihood and parameterisation described
above.</p>
<p>Future vignettes will provide a more detailed walk-through of the
Stan code and extensions such as alternative priors and model
comparison.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-lau_plateau_2022" class="csl-entry">
Lau, F. Din-Houn, and Sebastian Krumscheid. 2022. <span>‚ÄúPlateau
Proposal Distributions for Adaptive Component-Wise Multiple-Try
Metropolis.‚Äù</span> <em>METRON</em> 80 (3): 343‚Äì70. <a href="https://doi.org/10.1007/s40300-022-00235-y" class="external-link">https://doi.org/10.1007/s40300-022-00235-y</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adam N. H. Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
