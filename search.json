[{"path":"https://anhsmith.github.io/stage/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2025 Adam N. H. Smith Permission hereby granted, free charge, person obtaining copy software associated documentation files (â€œSoftwareâ€), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED â€œâ€, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://anhsmith.github.io/stage/articles/fit-stage.html","id":"fitting-the-stage-model","dir":"Articles","previous_headings":"","what":"Fitting the STAGE model","title":"Fitting the STAGE Model","text":"vignette shows : visualise STAGE likelihood, fit STAGE model simple simulated dataset, extract posterior transition points, extend hierarchical (multi-population) model. Conceptually, STAGE Bayesian generative classifier estimating transition point (e.g.Â length maturity). class fit asymmetric plateauâ€“Gaussian density: immature class uniform plateau followed Gaussian tail transition, mature class Gaussian tail transition followed uniform plateau. construction focuses inference overlap region prevents distant observations (e.g.Â small immatures, large matures) unduly influencing transition point.","code":""},{"path":"https://anhsmith.github.io/stage/articles/fit-stage.html","id":"the-stage-likelihood","dir":"Articles","previous_headings":"Fitting the STAGE model","what":"The STAGE likelihood","title":"Fitting the STAGE Model","text":"given truncation interval [L,U][L, U] transition point m50m_{50}, immature class (y=0y = 0) mean Î¼0=m50âˆ’d/2\\mu_0 = m_{50} - d/2, mature class (y=1y = 1) mean Î¼1=m50+d/2\\mu_1 = m_{50} + d/2, shared Gaussian spread Ïƒx\\sigma_x transition region plateau outside: Immature (left) density uniform [L,Î¼0][L, \\mu_0], Gaussian x>Î¼0x > \\mu_0 Mature (right) density Gaussian x<Î¼1x < \\mu_1, uniform [Î¼1,U][\\mu_1, U] class-conditional densities normalised integrates 1, transition probability Pr(y=1âˆ£x)\\Pr(y=1 \\mid x) arises Bayesâ€™ rule comparing two densities.","code":""},{"path":"https://anhsmith.github.io/stage/articles/fit-stage.html","id":"visualising-a-single-stage-transition","dir":"Articles","previous_headings":"Fitting the STAGE model > The STAGE likelihood","what":"Visualising a single STAGE transition","title":"Fitting the STAGE Model","text":"can now visualise simple STAGE configuration, showing: immature mature densities, resulting transition probability Pr(y=1âˆ£x)\\Pr(y=1 \\mid x).","code":"# parameters for the illustration L      <- 1000 U      <- 1700 sigma  <- 120 m50    <- 1350           # mid point d      <- 300            # separation mu0    <- m50 - d/2      # 1200 mu1    <- m50 + d/2      #   pdat <- tibble(x = L:U) |>    rowwise() |>    mutate(     \"y=0\" = plateau_gaussian_density_left(       x, mu = mu0, sigma = sigma, L = L),     \"y=1\" = plateau_gaussian_density_right(       x, mu = mu1, sigma = sigma, U = U)   ) |>    pivot_longer(     cols = c(`y=0`, `y=1`),     names_to = \"Class\",     values_to = \"Density\"   )   # base plot ggplot(pdat) +    aes(x=x, y=Density, fill=Class) +   geom_area(position = \"identity\", alpha = 0.5) # maximum density maxd <- max(pdat$Density)  p <- ggplot(pdat) +   aes(x = x, y = Density, fill = Class) +   geom_area(alpha = 0.45, position = \"identity\") +   scale_fill_manual(values = c(\"#00BFC4\", \"#F8766D\")) +   labs(     x = \"x\",     y = \"Density\",     fill = \"State\"   ) +   theme_minimal() +   theme(legend.position = \"none\")  # add labelled structure p +   # vertical lines for key parameters   geom_segment(aes(x = mu0, xend=mu0, y=0, yend=maxd), linetype = 2, colour = \"#00BFC4\") +   geom_segment(aes(x = mu1, xend=mu1, y=0, yend=maxd), linetype = 2, colour = \"#F8766D\") +   geom_segment(aes(x = m50, xend=m50, y=0, yend=maxd),  linetype = 2, colour = \"black\") +   geom_vline(xintercept = L,    linetype = 3, alpha = 0.3) +   geom_vline(xintercept = U,    linetype = 3, alpha = 0.3) +    # annotate regions   annotate(\"text\", x = L + 20,  y = 0.003, label = \"Plateau (y = 0)\", colour = \"#00BFC4\", hjust = 0) +   annotate(\"text\", x = U - 20,  y = 0.003, label = \"Plateau (y = 1)\", colour = \"#F8766D\", hjust = 1) +    annotate(\"text\", x = mu0, y = maxd, label = expression(mu[0]), colour = \"#00BFC4\", vjust = -0.4) +   annotate(\"text\", x = mu1, y = maxd, label = expression(mu[1]), colour = \"#F8766D\", vjust = -0.4) +   annotate(\"text\", x = m50, y = maxd, label = expression(m[50]), vjust = -0.5) +    # illustrate d   annotate(\"segment\",            x = mu0, xend = mu1, y = 0.001, yend = 0.001,            arrow = arrow(ends = \"both\", length = unit(0.12, \"cm\"))) +   annotate(\"text\", x = m50*1.03, y = 0.001*1.05, label = \"d\", vjust = 0, hjust = 0)"},{"path":"https://anhsmith.github.io/stage/articles/fit-stage.html","id":"simulating-data","dir":"Articles","previous_headings":"","what":"Simulating data","title":"Fitting the STAGE Model","text":"demonstrate workflow, simulate simple dataset lengths [L,U][L, U] smooth transition around true m50m_{50}.","code":"N <- 200 L <- 1000 U <- 1500 true_m50 <- 1250 true_d   <- 100  # Simulate covariate x <- runif(N, L, U)  # Smooth transition in P(mature) p <- plogis((x - true_m50) / (true_d / 4))  # Binary maturity indicator y <- rbinom(N, 1, p)  head(tibble(x = x, y = y)) #> # A tibble: 6 Ã— 2 #>       x     y #>   <dbl> <int> #> 1 1133.     0 #> 2 1186.     0 #> 3 1286.     1 #> 4 1454.     1 #> 5 1101.     0 #> 6 1449.     1"},{"path":"https://anhsmith.github.io/stage/articles/fit-stage.html","id":"fitting-the-stage-model-1","dir":"Articles","previous_headings":"","what":"Fitting the STAGE model","title":"Fitting the STAGE Model","text":"now fit STAGE model using fit_stage(). STAGE Bayesian model fit via Stan, keep chains iter small vignette keep runtime acceptable; real applications increase . can inspect posterior standard tools summary(fit$fit), bayesplot, posterior utilities want diagnostics.","code":"fit <- fit_stage(x, y, L = L, U = U, chains = 2, iter = 1000) fit"},{"path":"https://anhsmith.github.io/stage/articles/fit-stage.html","id":"extracting-the-transition-point","dir":"Articles","previous_headings":"Fitting the STAGE model","what":"Extracting the transition point","title":"Fitting the STAGE Model","text":"helper transition_point() returns posterior summaries global transition point m50m_{50}. Typical output small data frame posterior mean, median, credible intervals m50.","code":"transition_point(fit)"},{"path":"https://anhsmith.github.io/stage/articles/fit-stage.html","id":"predicting-maturity-probabilities","dir":"Articles","previous_headings":"Fitting the STAGE model","what":"Predicting maturity probabilities","title":"Fitting the STAGE Model","text":"can also predict Pr(matureâˆ£x)\\Pr(\\text{mature} \\mid x) grid lengths, plot posterior mean transition curve.","code":"x_grid <- seq(L, U, length.out = 200)  p_hat <- predict(fit, x_grid, type = \"prob\")  plot(   x_grid, p_hat, type = \"l\",   xlab = \"Length (x)\",   ylab = \"P(mature)\",   las = 1 )"},{"path":"https://anhsmith.github.io/stage/articles/fit-stage.html","id":"hierarchical-multi-population-model","dir":"Articles","previous_headings":"","what":"Hierarchical (multi-population) model","title":"Fitting the STAGE Model","text":"many applications multiple populations (e.g.Â regions, stocks, sexes) expect: shared average transition point Î¼m50\\mu_{m50}, population-specific deviations. STAGE implements using hierarchical structure m50pop[j]=Î¼m50+zjÏƒÎ±, m50_{\\text{pop}[j]} = \\mu_{m50} + z_j \\,\\sigma_\\alpha,  non-centred parameterisation efficient sampling. simple two-group example: transition_point(fit2) returns : global m50 (overall mean transition) group-specific m50_pop[j] values.","code":"group <- rep(c(\"A\", \"B\"), each = N/2)  fit2 <- fit_stage(   x, y,   group = group,   L = L, U = U,   chains = 2, iter = 1000 )  transition_point(fit2)"},{"path":"https://anhsmith.github.io/stage/articles/fit-stage.html","id":"summary","dir":"Articles","previous_headings":"","what":"Summary","title":"Fitting the STAGE Model","text":"vignette : introduced plateauâ€“Gaussian likelihood underlying STAGE, visualised class densities resulting transition probabilities, simulated simple dataset, fit STAGE model estimate transition point, extended model hierarchical multi-population setting. practice, want : choose [L,U][L, U] capture transition zone plus plateau side, check posterior diagnostics (divergences, R-hat, effective sample sizes), interpret m50m_{50} uncertainty biological context. Future vignettes expand : comparing STAGE logistic regression Gaussian LDA, sensitivity choice [L,U][L, U] prior settings.","code":""},{"path":"https://anhsmith.github.io/stage/articles/likelihood.html","id":"overview","dir":"Articles","previous_headings":"","what":"Overview","title":"The STAGE Likelihood","text":"vignette describes likelihood parameterisation used STAGE model. STAGE hierarchical Bayesian generative model designed estimate transition point m50m_{50} variable xx two classesâ€”example, length individuals transition immature mature. model produces posterior distribution key parameter m50m_{50}, representing value xx probabilities Pr(y=0)Pr(y=0) Pr(y=1)\\Pr(y=1) equal. model can also used derive useful quantities (class probabilities Pr(y=1âˆ£x)\\Pr(y = 1 \\mid x)). central idea model class piecewise density combines uniform plateau regions far transition, Gaussian tail transition region. left group (y=0y = 0) modelled uniform left begins lower truncation value LL. distribution remains flat approaches transition range, point distribution declines according Gaussian. right group (y=1y = 1) mirror image leftâ€”increases according Gaussian distribution levels uniform, terminating upper truncation value UU. model focuses inference transition zone, values xx two classes overlap, thereby limiting influence observations biologically uninformative far away transition point. PDF uniform-Gaussian used modified PDF uniform two Guassians described Lau & Krumscheid (2022).","code":""},{"path":"https://anhsmith.github.io/stage/articles/likelihood.html","id":"model-summary","dir":"Articles","previous_headings":"","what":"Model summary","title":"The STAGE Likelihood","text":"observe pairs (xi,yi)(x_i, y_i) =1,â€¦,Ni = 1, \\dots, N, xix_i continuous covariate (e.g., length), truncated interval [L,U][L, U], yiâˆˆ{0,1}y_i \\\\{0, 1\\} binary indicator state (e.g., immature / mature). model assumes distribution xx conditional state piecewise: y=0y = 0 (immature individuals), distribution xx approximately uniform point Î¼0\\mu_0, follows Gaussian decay. y=1y = 1 (mature individuals), distribution Gaussian point Î¼1\\mu_1, uniform Î¼1\\mu_1 upper truncation UU. transition point m50m_{50} defined value xx probability observing either class equal: Pr(y=0âˆ£x=m50)=Pr(y=1âˆ£x=m50). \\Pr(y = 0 \\mid x = m_{50}) = \\Pr(y = 1 \\mid x = m_{50}). Additional parameters govern width sharpness transition: dd controls distance Î¼0\\mu_0 Î¼1\\mu_1 (width transition region), Ïƒ\\sigma controls spread (standard deviation) Gaussian tails. allowing different behaviours either side m50m_{50}, model can capture asymmetric transition patterns: immature class can decline towards transition different rate mature class rises . particularly useful settings : boundary classes sharp, data exhibit gradual overlap two classes.","code":""},{"path":"https://anhsmith.github.io/stage/articles/likelihood.html","id":"likelihood","dir":"Articles","previous_headings":"","what":"Likelihood","title":"The STAGE Likelihood","text":"likelihood built two unnormalised log-density functions two classes. work log scale numerical stability subtract log-normalising constants ensure valid densities. Let f0(x)f_0(x) f1(x)f_1(x) denote unnormalised densities two classes.","code":""},{"path":"https://anhsmith.github.io/stage/articles/likelihood.html","id":"lower-class-y-0","dir":"Articles","previous_headings":"Likelihood","what":"Lower class (y=0y = 0)","title":"The STAGE Likelihood","text":"yi=0y_i = 0, unnormalised piecewise log-density : f(xiâˆ£yi=0,Î¼0,Ïƒ,L)={0if xi<L1if Lâ‰¤xiâ‰¤Î¼0âˆ’(xiâˆ’Î¼0)22Ïƒ2if xi>Î¼0 f(x_i \\mid y_i = 0, \\mu_0, \\sigma, L) = \\begin{cases} 0 & \\text{} x_i < L \\\\ 1 & \\text{} L \\leq x_i \\leq \\mu_0 \\\\ -\\dfrac{(x_i - \\mu_0)^2}{2\\sigma^2} & \\text{} x_i > \\mu_0 \\end{cases} : plateau region [L,Î¼0][L, \\mu_0] constant (log-)density 1, tail region xi>Î¼0x_i > \\mu_0 decays according Gaussian kernel. implementation, treated unnormalised log-density; overall density recovered subtracting normalising constant.","code":""},{"path":"https://anhsmith.github.io/stage/articles/likelihood.html","id":"higher-class-y-1","dir":"Articles","previous_headings":"Likelihood","what":"Higher class (y=1y = 1)","title":"The STAGE Likelihood","text":"yi=1y_i = 1, unnormalised piecewise log-density : f(xiâˆ£yi=1,Î¼1,Ïƒ,U)={âˆ’(xiâˆ’Î¼1)22Ïƒ2if xi<Î¼11if Î¼1â‰¤xiâ‰¤U0if xi>U f(x_i \\mid y_i = 1, \\mu_1, \\sigma, U) = \\begin{cases} -\\dfrac{(x_i - \\mu_1)^2}{2\\sigma^2} & \\text{} x_i < \\mu_1 \\\\ 1 & \\text{} \\mu_1 \\leq x_i \\leq U \\\\ 0 & \\text{} x_i > U \\end{cases} Now: Gaussian tail Î¼1\\mu_1, plateau covers upper region [Î¼1,U][\\mu_1, U]. cases, effectively using plateauâ€“Gaussian mixture: flat density class â€œdominatesâ€ Gaussian shape transition region class present.","code":""},{"path":"https://anhsmith.github.io/stage/articles/likelihood.html","id":"normalisation-constants","dir":"Articles","previous_headings":"Likelihood","what":"Normalisation constants","title":"The STAGE Likelihood","text":"convert unnormalised densities proper probability density functions (pdf), divide constants C0C_0 C1C_1 chosen densities integrate 1 [L,U][L, U]. immature class, normalising constant : C0=2Ï€Ïƒ2+(Î¼0âˆ’L). C_0 = \\frac{\\sqrt{2\\pi} \\, \\sigma}{2} + (\\mu_0 - L). mature class, normalising constant : C1=2Ï€Ïƒ2+(Uâˆ’Î¼1). C_1 = \\frac{\\sqrt{2\\pi} \\, \\sigma}{2} + (U - \\mu_1). Intuitively: (Î¼0âˆ’L)(\\mu_0 - L) (Uâˆ’Î¼1)(U - \\mu_1) widths uniform plateaus, 2Ï€Ïƒ/2\\sqrt{2\\pi}\\,\\sigma / 2 contribution half-Gaussian tail. log-likelihood contributions observation : logâ„’i={logf(xi)âˆ’logC0if yi=0logf(xi)âˆ’logC1if yi=1. \\log \\mathcal{L}_i \\;=\\; \\begin{cases} \\log f(x_i) - \\log C_0 & \\text{} y_i = 0 \\\\ \\log f(x_i) - \\log C_1 & \\text{} y_i = 1. \\end{cases}","code":""},{"path":"https://anhsmith.github.io/stage/articles/likelihood.html","id":"full-log-likelihood","dir":"Articles","previous_headings":"Likelihood","what":"Full log-likelihood","title":"The STAGE Likelihood","text":"Summing observations, joint log-likelihood : logp(x,yâˆ£m50,d,Ïƒ)=âˆ‘=1N[logf(xiâˆ£yi,Î¼yi,Ïƒ)âˆ’logCyi], \\log p(x, y \\mid m_{50}, d, \\sigma) \\;=\\; \\sum_{=1}^{N} \\left[   \\log f(x_i \\mid y_i, \\mu_{y_i}, \\sigma)   - \\log C_{y_i} \\right], f(â‹…)f(\\cdot) appropriate unnormalised density class yiy_i, Cyiâˆˆ{C0,C1}C_{y_i} \\\\{C_0, C_1\\} normalising constant class.","code":""},{"path":"https://anhsmith.github.io/stage/articles/likelihood.html","id":"prior-specification","dir":"Articles","previous_headings":"","what":"Prior specification","title":"The STAGE Likelihood","text":"priors reflect prior beliefs plausible transition points transition widths typical length--maturity problems (can changed user). Transition point m50m_{50}: m50âˆ¼ð’©(1300,50), m_{50} \\sim \\mathcal{N}(1300, 50), centres transition around 1300 (mm) moderate uncertainty. Transition width dd: dâˆ¼ð’©(100,100), d \\sim \\mathcal{N}(100, 100), allows width overlap region vary around 100 units wide spread. Gaussian spread Ïƒ\\sigma: Ïƒâˆ¼ð’©(100,50), \\sigma \\sim \\mathcal{N}(100, 50), representing prior beliefs scale variability transition tails. practice, adapt priors scale (e.g., lengths, ages) prior biological knowledge. STAGE implementation allows pass hyperparameters via helper functions (e.g.Â stage_priors()).","code":""},{"path":"https://anhsmith.github.io/stage/articles/likelihood.html","id":"transformed-parameters","dir":"Articles","previous_headings":"","what":"Transformed parameters","title":"The STAGE Likelihood","text":"Gaussian â€œcentresâ€ two classes defined terms transition point m50m_{50} width parameter dd: Î¼0=m50âˆ’d2,Î¼1=m50+d2. \\mu_0 = m_{50} - \\frac{d}{2}, \\qquad \\mu_1 = m_{50} + \\frac{d}{2}. Thus: dd controls distance immature mature Gaussian means, m50m_{50} remains midpoint . convenient conceptually computationally: allows model focus directly m50m_{50} dd, often primary scientific targets, Î¼0\\mu_0 Î¼1\\mu_1 derived quantities.","code":""},{"path":"https://anhsmith.github.io/stage/articles/likelihood.html","id":"from-class-densities-to-class-probabilities-bayes-rule","dir":"Articles","previous_headings":"","what":"From class densities to class probabilities (Bayes rule)","title":"The STAGE Likelihood","text":"likelihood defines class-conditional densitiesf0(x)=p(xâˆ£y=0)f_0(x) = p(x \\mid y = 0) f1(x)=p(xâˆ£y=1)f_1(x) = p(x \\mid y = 1) [L,U][L, U]. obtain probability individual particular xx value higher class (y=1y = 1), use Bayes rule: Pr(y=1âˆ£x)=Ï€1f1(x)Ï€0f0(x)+Ï€1f1(x), \\Pr(y = 1 \\mid x) = \\frac{\\pi_1 f_1(x)}{\\pi_0 f_0(x) + \\pi_1 f_1(x)}, similarly Pr(y=0âˆ£x)=Ï€0f0(x)Ï€0f0(x)+Ï€1f1(x), \\Pr(y = 0 \\mid x) = \\frac{\\pi_0 f_0(x)}{\\pi_0 f_0(x) + \\pi_1 f_1(x)}, Ï€0\\pi_0 Ï€1\\pi_1 prior class probabilities (e.g., prior probabilities immature mature seeing xx). many applications, estimating length--maturity, interested transition point driven sample sizes prevalence, natural use equal class priors, Ï€0=Ï€1=1/2\\pi_0 = \\pi_1 = 1/2. case, Bayes rule simplifies Pr(y=1âˆ£x)=f1(x)f0(x)+f1(x),Pr(y=0âˆ£x)=f0(x)f0(x)+f1(x). \\Pr(y = 1 \\mid x) = \\frac{f_1(x)}{f_0(x) + f_1(x)}, \\qquad \\Pr(y = 0 \\mid x) = \\frac{f_0(x)}{f_0(x) + f_1(x)}. class probabilities STAGE model uses prediction, see plot Pr(y=1âˆ£x)\\Pr(y = 1 \\mid x) function xx.","code":""},{"path":"https://anhsmith.github.io/stage/articles/likelihood.html","id":"connection-to-m_50","dir":"Articles","previous_headings":"From class densities to class probabilities (Bayes rule)","what":"Connection to m50m_{50}","title":"The STAGE Likelihood","text":"definition, transition point m50m_{50} value xx two classes equally probable: Pr(y=0âˆ£x=m50)=Pr(y=1âˆ£x=m50)=12. \\Pr(y = 0 \\mid x = m_{50}) = \\Pr(y = 1 \\mid x = m_{50}) = \\frac{1}{2}. Using Bayes rule equal class priors, equality equivalent f1(m50)f0(m50)+f1(m50)=f0(m50)f0(m50)+f1(m50)â‡”f0(m50)=f1(m50). \\frac{f_1(m_{50})}{f_0(m_{50}) + f_1(m_{50})} = \\frac{f_0(m_{50})}{f_0(m_{50}) + f_1(m_{50})} \\quad\\Longleftrightarrow\\quad f_0(m_{50}) = f_1(m_{50}). Thus, m50m_{50} can viewed two equivalent ways: model parameter sets midpoint Gaussian centres Î¼0\\mu_0 Î¼1\\mu_1 viaÎ¼0=m50âˆ’d2,Î¼1=m50+d2, \\mu_0 = m_{50} - \\frac{d}{2}, \\qquad \\mu_1 = m_{50} + \\frac{d}{2}, Bayes classifier cut-point posterior class probabilities immature mature 0.5. practice, STAGE model samples m50m_{50}, dd, Ïƒ\\sigma posterior distribution. posterior draw, can compute Pr(y=1âˆ£x)\\Pr(y = 1 \\mid x) via Bayes rule verify point curve crosses 0.5 aligns sampled value m50m_{50}. makes interpretation m50m_{50} â€œ50% maturityâ€ transition point directly linked underlying generative model Bayes-optimal classifier.","code":""},{"path":"https://anhsmith.github.io/stage/articles/likelihood.html","id":"advantages-of-the-stage-likelihood","dir":"Articles","previous_headings":"","what":"Advantages of the STAGE likelihood","title":"The STAGE Likelihood","text":"Piecewise densities plateauâ€“Gaussian form naturally captures situations individuals one class (e.g., immatures) approximately uniform wide region, decline gradually transition. Similarly mature class. realistic assuming global Gaussian class. Focus transition region Gaussian tails enter overlap region, estimation m50m_{50} driven observations near transition. Distant observations (e.g., small immatures, large matures) mainly contribute uniform plateau therefore distort transition point. Flexibility via dd parameter dd controls width transition zone, allowing model capture anything sharp gradual transitions. Bayesian inference fully Bayesian treatment: incorporates prior knowledge (e.g., plausible ranges m50m_{50}), provides full posterior uncertainty parameters, extends naturally hierarchical models multiple populations. Proper normalisation explicit normalising constants C0C_0 C1C_1 ensure class-conditional density valid pdf. crucial stable inference Stan interpreting posterior predictions probabilities.","code":""},{"path":"https://anhsmith.github.io/stage/articles/likelihood.html","id":"relationship-to-the-stage-implementation","dir":"Articles","previous_headings":"","what":"Relationship to the stage implementation","title":"The STAGE Likelihood","text":"stage package: single-population model uses parameters m50, d, sigma_x correspond m50m_{50}, dd, Ïƒ\\sigma vignette. multi-population (hierarchical) model introduces population-specific transition points m50,jm_{50, j} via random-effects structure: m50pop[j]=Î¼m50+zjÏƒÎ±, m50_{\\text{pop}[j]} = \\mu_{m50} + z_j \\, \\sigma_\\alpha,  Î¼m50\\mu_{m50} overall mean transition point, zjz_j standard-normal effects, ÏƒÎ±\\sigma_\\alpha population-level standard deviation. Stan code used fit_stage() direct implementation likelihood parameterisation described . Future vignettes provide detailed walk-Stan code extensions alternative priors model comparison.","code":""},{"path":[]},{"path":[]},{"path":"https://anhsmith.github.io/stage/articles/why-stage.html","id":"problems-with-existing-methods","dir":"Articles","previous_headings":"Introduction","what":"Problems with existing methods","title":"Why STAGE?","text":"Estimating transition pointâ€”length individuals shift immature matureâ€”simple common task, surprisingly difficult. Existing methods fail important ways.","code":""},{"path":"https://anhsmith.github.io/stage/articles/why-stage.html","id":"ad-hoc-midpoint-methods","dir":"Articles","previous_headings":"Introduction > Problems with existing methods","what":"Ad hoc midpoint methods","title":"Why STAGE?","text":"common practice avoid fitting model altogether instead compute transition point directly data. widespread example midpoint smallest mature largest immature individuals. advantage approach focuses transition zone . However, approach (1) probabilistic foundation quantify uncertainty, (2) uses two data points, high variance.","code":""},{"path":"https://anhsmith.github.io/stage/articles/why-stage.html","id":"discriminative-models-e-g--logistic-regression","dir":"Articles","previous_headings":"Introduction > Problems with existing methods","what":"Discriminative models (e.g., logistic regression)","title":"Why STAGE?","text":"Discriminative models logistic regression estimate conditional probability P(y=1âˆ£x)P(y = 1 \\mid x)directly. words, model focuses predicting class labels based prevalence one class vs another value xx. simple familiar, suffer two major issues setting: Sensitivity class imbalance. Logistic regression (discriminative models) estimates probability maturity sample, population. Unless sampling independent class size, estimated curve can seriously biased. one class much greater sample size (.e., unbalanced), logistic regression effectively places weight abundant class. pulls estimated transition curve toward majority class, even though class counts determine transition occurs. Influence biologically irrelevant regions. Observations far transition zone change fitted slope interceptâ€”even though contain information transition takes place. example, true transition around 1000 mm, individuals 200â€“400 mm influence estimate maturity transition, discriminative model often . advantage discriminative-model approach inferences transition point based mainly data near transition zone.","code":""},{"path":"https://anhsmith.github.io/stage/articles/why-stage.html","id":"gaussian-generative-models-e-g--linear-discriminant-analysis","dir":"Articles","previous_headings":"Introduction > Problems with existing methods","what":"Gaussian generative models (e.g., Linear Discriminant Analysis)","title":"Why STAGE?","text":"Generative classifiers model class-conditional densities f(xâˆ£y=0),f(xâˆ£y=1)f(x \\mid y = 0), \\qquad f(x \\mid y = 1), obtain P(y=1âˆ£x)P(y=1 \\mid x)via Bayesâ€™ rule. generative classifier approach advantage less sensitive class imbalance, since transition point estimate depends shapes class distributions, relative sample sizes. achieved fitting density class separately, calculating transition point based relative densities two classes. Linear Discriminant Analysis (LDA) widely used generative classifier fits Gaussian (Normal) density class. However, generative models less sensitive class imbalance, suffer another important limitation: estimation transition point influenced values xx, just near transition zone. LDA, Gaussian tail behaviour near transition determined estimated mean variance classâ€”estimates strongly affected observations far transition. context length--maturity, means small immature individuals (e.g., neonates) large mature individuals much influence transition point individuals whose lengths fall near maturity boundary. unappealing, distant observations contain almost information location transition, yet shape Gaussian fits can shift inferred transition point substantially. creates structural problem: two tails actually matter transitionâ€”upper tail immature class lower tail mature classâ€”modelled directly . Instead, tail constrained mirror image opposite tail class (global Gaussian assumption).","code":""},{"path":"https://anhsmith.github.io/stage/articles/why-stage.html","id":"summary","dir":"Articles","previous_headings":"Introduction","what":"Summary","title":"Why STAGE?","text":"needed model estimating transition points : probabilistic can quantify uncertainty, robust class imbalance, focuses inference data overlap region rather distant data.","code":""},{"path":"https://anhsmith.github.io/stage/articles/why-stage.html","id":"the-stage-solution","dir":"Articles","previous_headings":"","what":"The STAGE solution","title":"Why STAGE?","text":"STAGE model Bayesian generative classifier class fit asymmetric Uniformâ€“Gaussian mixture. Immature (y = 0): uniform plateau â†’ Gaussian decay approaching transition. Mature (y = 1): Gaussian rise transition â†’ uniform plateau. design several key consequences:","code":""},{"path":"https://anhsmith.github.io/stage/articles/why-stage.html","id":"generative-modelling","dir":"Articles","previous_headings":"The STAGE solution","what":"Generative modelling","title":"Why STAGE?","text":"Transition probability arises comparing relative densities (Bayes rule), discriminative regression.","code":""},{"path":"https://anhsmith.github.io/stage/articles/why-stage.html","id":"irrelevant-regions-contribute-minimally","dir":"Articles","previous_headings":"The STAGE solution","what":"Irrelevant regions contribute minimally","title":"Why STAGE?","text":"Observations far transition zone enter via uniform component, distort estimates transition point.","code":""},{"path":"https://anhsmith.github.io/stage/articles/why-stage.html","id":"robust-to-imbalance","dir":"Articles","previous_headings":"The STAGE solution","what":"Robust to imbalance","title":"Why STAGE?","text":"inference depends shape densitiesâ€”countsâ€” unbalanced datasets bias m50.","code":""},{"path":"https://anhsmith.github.io/stage/articles/why-stage.html","id":"bayesian-inference","dir":"Articles","previous_headings":"The STAGE solution","what":"Bayesian inference","title":"Why STAGE?","text":"Posterior uncertainty natural, multi-population structure handled hierarchical model. STAGE likelihood structured mixture inspired plateauâ€“Gaussian formulation Lau & Krumscheid (2022), adapted transition-point estimation.","code":""},{"path":"https://anhsmith.github.io/stage/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Adam N. H. Smith. Author, maintainer.","code":""},{"path":"https://anhsmith.github.io/stage/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Smith, . (2025). *STAGE: State Transition Analysis via Generative Estimator.* R package version 0.1.0. Available : https://github.com/anhsmith/stage.","code":"@Manual{,   title = {STAGE: State Transition Analysis via Generative Estimator},   author = {Adam N. H. Smith},   year = {2025},   note = {R package version 0.1.0},   url = {https://github.com/anhsmith/stage}, }"},{"path":"https://anhsmith.github.io/stage/index.html","id":"id_-stage-","dir":"","previous_headings":"","what":"Models for Estimating Stage-Transition Points","title":"Models for Estimating Stage-Transition Points","text":"stage package implements STAGE model (State Transition Analysis via Generative Estimator), Bayesian generative classifier estimating transition points (m50) two groupsâ€”value xx y=1y=1 become probable. example length--maturity problems, yy binary maturity status, xx continuous measurement, length. Existing methods sorts applications important limitations (see ), STAGE model overcomes. Features STAGE model : class fit mixture distribution combines uniform plateau Gaussian tail Estimation transition point (m50) based relative densities (Bayesâ€™ rule) classes given xx, discriminative regression shared transition region centred m50 width d. goal model transition-point estimation focuses inference data around transition point robust unbalanced sample sizes.  process testing STAGE model methods underway.","code":""},{"path":"https://anhsmith.github.io/stage/index.html","id":"package-features","dir":"","previous_headings":"","what":"Package features","title":"Models for Estimating Stage-Transition Points","text":"fit_stage() â€” fit STAGE model (single multi-population) transition_point() â€” summarise posteriors m50 predict.stage_fit() â€” predict class probabilities labels stage_priors() â€” prior helper get_cmdstan_model() â€” internal CmdStan compiler helper Planned additions: Reparameterised logistic/HOF model Bayesian LDA Posterior predictive classification Diagnostic + visualisation tools Full vignette","code":""},{"path":"https://anhsmith.github.io/stage/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Models for Estimating Stage-Transition Points","text":"need cmdstanr + CmdStan installed: install GitHub:","code":"install.packages(\"cmdstanr\",   repos = c(\"https://mc-stan.org/r-packages/\", getOption(\"repos\")) ) cmdstanr::install_cmdstan()   # run once devtools::install_github(\"anhsmith/stage\")"},{"path":"https://anhsmith.github.io/stage/index.html","id":"example","dir":"","previous_headings":"","what":"Example","title":"Models for Estimating Stage-Transition Points","text":"Estimated transition point: Prediction:","code":"library(stage)  set.seed(123)  N <- 200 L <- 1000 U <- 1500 true_m50 <- 1250 true_d   <- 100  # simulate data x <- runif(N, L, U) p <- plogis((x - true_m50) / (true_d / 4)) y <- rbinom(N, 1, p)  # fit STAGE model fit <- fit_stage(x, y, L = L, U = U, chains = 2, iter = 1000) fit transition_point(fit) x_grid <- seq(L, U, length.out = 100) p_hat <- predict(fit, x_grid, type = \"prob\")  plot(x_grid, p_hat, type = \"l\",      xlab = \"x\", ylab = \"P(mature)\", las = 1)"},{"path":"https://anhsmith.github.io/stage/index.html","id":"hierarchical-model","dir":"","previous_headings":"","what":"Hierarchical model","title":"Models for Estimating Stage-Transition Points","text":"Multiple populations: returns: global m50 group-specific m50_pop[j]","code":"group <- rep(c(\"A\",\"B\"), each = N/2)  fit2 <- fit_stage(x, y, group = group, L = L, U = U)  transition_point(fit2)"},{"path":"https://anhsmith.github.io/stage/index.html","id":"model-summary","dir":"","previous_headings":"","what":"Model summary","title":"Models for Estimating Stage-Transition Points","text":"class uniform plateau Gaussian edge. Key parameters: m50 â€” transition centre d â€” width transition region sigma_x â€” Gaussian spread Hierarchical structure: (non-centred parameterisation efficient sampling)","code":"m50_pop[j] = mu_m50 + z[j] * sigma_alpha"},{"path":"https://anhsmith.github.io/stage/index.html","id":"development","dir":"","previous_headings":"","what":"Development","title":"Models for Estimating Stage-Transition Points","text":"","code":"devtools::test() devtools::document() devtools::build_readme()"},{"path":"https://anhsmith.github.io/stage/index.html","id":"license","dir":"","previous_headings":"","what":"License","title":"Models for Estimating Stage-Transition Points","text":"MIT Â© Adam N. H. Smith","code":""},{"path":"https://anhsmith.github.io/stage/reference/fit_stage.html","id":null,"dir":"Reference","previous_headings":"","what":"Fit the STAGE (uniform + Gaussian) generative model â€” fit_stage","title":"Fit the STAGE (uniform + Gaussian) generative model â€” fit_stage","text":"Fit STAGE (uniform + Gaussian) generative model","code":""},{"path":"https://anhsmith.github.io/stage/reference/fit_stage.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Fit the STAGE (uniform + Gaussian) generative model â€” fit_stage","text":"","code":"fit_stage(   x,   y,   group = NULL,   L = NULL,   U = NULL,   priors = stage_priors(x, y),   chains = 4,   iter = 2000,   ... )"},{"path":"https://anhsmith.github.io/stage/reference/fit_stage.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Fit the STAGE (uniform + Gaussian) generative model â€” fit_stage","text":"x Numeric vector predictor values (e.g. length). y Binary vector: 0 = immature, 1 = mature. group Optional grouping variable (population). NULL, data treated one population (J = 1). L, U Truncation bounds x. NULL, use min(x) max(x). priors list prior hyperparameters created stage_priors(). chains, iter, ... Passed cmdstanr::sample().","code":""},{"path":"https://anhsmith.github.io/stage/reference/fit_stage.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Fit the STAGE (uniform + Gaussian) generative model â€” fit_stage","text":"object class \"stage_fit\".","code":""},{"path":"https://anhsmith.github.io/stage/reference/get_cmdstan_model.html","id":null,"dir":"Reference","previous_headings":"","what":"Get compiled cmdstanr model â€” get_cmdstan_model","title":"Get compiled cmdstanr model â€” get_cmdstan_model","text":"Get compiled cmdstanr model Get compiled cmdstanr model inst/stan","code":""},{"path":"https://anhsmith.github.io/stage/reference/get_cmdstan_model.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Get compiled cmdstanr model â€” get_cmdstan_model","text":"","code":"get_cmdstan_model(stan_file)  get_cmdstan_model(stan_file)"},{"path":"https://anhsmith.github.io/stage/reference/plateau_gaussian_density_left.html","id":null,"dir":"Reference","previous_headings":"","what":"Computes the normalised plateauâ€“Gaussian density used for y = 0 â€” plateau_gaussian_density_left","title":"Computes the normalised plateauâ€“Gaussian density used for y = 0 â€” plateau_gaussian_density_left","text":"Computes normalised plateauâ€“Gaussian density used y = 0","code":""},{"path":"https://anhsmith.github.io/stage/reference/plateau_gaussian_density_left.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Computes the normalised plateauâ€“Gaussian density used for y = 0 â€” plateau_gaussian_density_left","text":"","code":"plateau_gaussian_density_left(x, mu, sigma, L)"},{"path":"https://anhsmith.github.io/stage/reference/plateau_gaussian_density_left.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Computes the normalised plateauâ€“Gaussian density used for y = 0 â€” plateau_gaussian_density_left","text":"x vector x-values mu mean location Gaussian tail sigma transition spread L lower truncation","code":""},{"path":"https://anhsmith.github.io/stage/reference/plateau_gaussian_density_right.html","id":null,"dir":"Reference","previous_headings":"","what":"Computes the normalised plateauâ€“Gaussian density used for y = 1 â€” plateau_gaussian_density_right","title":"Computes the normalised plateauâ€“Gaussian density used for y = 1 â€” plateau_gaussian_density_right","text":"Computes normalised plateauâ€“Gaussian density used y = 1","code":""},{"path":"https://anhsmith.github.io/stage/reference/plateau_gaussian_density_right.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Computes the normalised plateauâ€“Gaussian density used for y = 1 â€” plateau_gaussian_density_right","text":"","code":"plateau_gaussian_density_right(x, mu, sigma, U)"},{"path":"https://anhsmith.github.io/stage/reference/plateau_gaussian_density_right.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Computes the normalised plateauâ€“Gaussian density used for y = 1 â€” plateau_gaussian_density_right","text":"x vector x-values mu mean Gaussian tail sigma transition spread U upper truncation","code":""},{"path":"https://anhsmith.github.io/stage/reference/predict.stage_fit.html","id":null,"dir":"Reference","previous_headings":"","what":"Predict class probabilities from a STAGE model â€” predict.stage_fit","title":"Predict class probabilities from a STAGE model â€” predict.stage_fit","text":"Predict class probabilities STAGE model","code":""},{"path":"https://anhsmith.github.io/stage/reference/predict.stage_fit.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Predict class probabilities from a STAGE model â€” predict.stage_fit","text":"","code":"# S3 method for class 'stage_fit' predict(object, newdata, group = NULL, type = c(\"prob\", \"class\"), ...)"},{"path":"https://anhsmith.github.io/stage/reference/predict.stage_fit.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Predict class probabilities from a STAGE model â€” predict.stage_fit","text":"object stage_fit object returned fit_stage(). newdata Numeric vector new x values. group Optional group new x (length 1 length(newdata)). NULL multiple populations model, population 1 used predictions. type \"prob\" P(y = 1 | x), \"class\" 0/1 classification. ... Currently ignored.","code":""},{"path":"https://anhsmith.github.io/stage/reference/predict.stage_fit.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Predict class probabilities from a STAGE model â€” predict.stage_fit","text":"Numeric vector probabilities classes.","code":""},{"path":"https://anhsmith.github.io/stage/reference/stage_priors.html","id":null,"dir":"Reference","previous_headings":"","what":"Construct prior hyperparameters for the STAGE model â€” stage_priors","title":"Construct prior hyperparameters for the STAGE model â€” stage_priors","text":"Construct prior hyperparameters STAGE model","code":""},{"path":"https://anhsmith.github.io/stage/reference/stage_priors.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Construct prior hyperparameters for the STAGE model â€” stage_priors","text":"","code":"stage_priors(   x = NULL,   y = NULL,   prior_mu_m50_mu = if (!is.null(x)) stats::median(x) else 0,   prior_mu_m50_tau = if (!is.null(x)) diff(range(x))/6 else 100,   prior_d_mu = if (!is.null(x)) diff(range(x))/4 else 0,   prior_d_tau = if (!is.null(x)) diff(range(x))/4 else 100,   prior_sigma_x_tau = if (!is.null(x)) stats::sd(x) else 100,   prior_sigma_alpha_tau = if (!is.null(x)) diff(range(x))/6 else 100 )"},{"path":"https://anhsmith.github.io/stage/reference/stage_priors.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Construct prior hyperparameters for the STAGE model â€” stage_priors","text":"x, y Optional data vectors set sensible defaults. prior_mu_m50_mu Mean prior global m50. prior_mu_m50_tau SD prior global m50. prior_d_mu Mean prior d. prior_d_tau SD prior d. prior_sigma_x_tau SD scale sigma_x. prior_sigma_alpha_tau SD scale sigma_alpha (-pop).","code":""},{"path":"https://anhsmith.github.io/stage/reference/stage_priors.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Construct prior hyperparameters for the STAGE model â€” stage_priors","text":"list elements matching Stan data block.","code":""},{"path":"https://anhsmith.github.io/stage/reference/transition_point.html","id":null,"dir":"Reference","previous_headings":"","what":"Generic transition point extractor â€” transition_point","title":"Generic transition point extractor â€” transition_point","text":"Generic transition point extractor","code":""},{"path":"https://anhsmith.github.io/stage/reference/transition_point.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Generic transition point extractor â€” transition_point","text":"","code":"transition_point(object, ...)"},{"path":"https://anhsmith.github.io/stage/reference/transition_point.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Generic transition point extractor â€” transition_point","text":"object model fit object. ... arguments passed methods.","code":""},{"path":"https://anhsmith.github.io/stage/reference/transition_point.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Generic transition point extractor â€” transition_point","text":"Typically numeric vector list summarising transition point.","code":""},{"path":"https://anhsmith.github.io/stage/reference/transition_point.stage_fit.html","id":null,"dir":"Reference","previous_headings":"","what":"Posterior summaries of STAGE transition points (m50) â€” transition_point.stage_fit","title":"Posterior summaries of STAGE transition points (m50) â€” transition_point.stage_fit","text":"Posterior summaries STAGE transition points (m50)","code":""},{"path":"https://anhsmith.github.io/stage/reference/transition_point.stage_fit.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Posterior summaries of STAGE transition points (m50) â€” transition_point.stage_fit","text":"","code":"# S3 method for class 'stage_fit' transition_point(object, population = NULL, ...)"},{"path":"https://anhsmith.github.io/stage/reference/transition_point.stage_fit.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Posterior summaries of STAGE transition points (m50) â€” transition_point.stage_fit","text":"object stage_fit object returned fit_stage(). population Optional population index (integer) label (character). NULL, return global populations. ... Currently ignored. Included method compatibility.","code":""},{"path":"https://anhsmith.github.io/stage/reference/transition_point.stage_fit.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Posterior summaries of STAGE transition points (m50) â€” transition_point.stage_fit","text":"named list numeric vector posterior summary stats.","code":""}]
