<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Models for Estimating Stage-Transition Points • stage</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" sizes="any" href="favicon.ico">
<link rel="manifest" href="site.webmanifest">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Models for Estimating Stage-Transition Points">
<meta name="description" content="The STAGE package implements Bayesian models for estimating transition points between two classes. The model developed specifically in this package is the STAGE model (State Transition Analysis via Generative Estimator), which fits a uniform (plateau) region and a Gaussian tail to each maturity stage. Other models offered include the HOF parameterisation of logistic regression, and Linear Discriminant Analysis (all Bayesian). The package provides functions for fitting single-population and hierarchical models, extracting posterior transition points (m50), producing predictions, and summarising uncertainty. The methods are designed for applications such as maturity estimation and other problems involving class overlap and asymmetric distributions.">
<meta property="og:description" content="The STAGE package implements Bayesian models for estimating transition points between two classes. The model developed specifically in this package is the STAGE model (State Transition Analysis via Generative Estimator), which fits a uniform (plateau) region and a Gaussian tail to each maturity stage. Other models offered include the HOF parameterisation of logistic regression, and Linear Discriminant Analysis (all Bayesian). The package provides functions for fitting single-population and hierarchical models, extracting posterior transition points (m50), producing predictions, and summarising uncertainty. The methods are designed for applications such as maturity estimation and other problems involving class overlap and asymmetric distributions.">
<meta property="og:image" content="https://anhsmith.github.io/stage/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">stage</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/motivation.html">Motivation</a></li>
    <li><a class="dropdown-item" href="articles/likelihood.html">The STAGE Likelihood</a></li>
    <li><a class="dropdown-item" href="articles/fit-stage.html">Fitting STAGE</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-links" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Links</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-links">
<li><a class="external-link dropdown-item" href="https://wwww.seathrough.science">Sea Through Science</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org">Stan</a></li>
    <li><a class="external-link dropdown-item" href="https://mc-stan.org/cmdstanr/">CmdStanR</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/">tidyverse</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/anhsmith/stage" aria-label="stage GitHub repository"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="stage-">stage <a class="anchor" aria-label="anchor" href="#stage-"></a>
</h1>
</div>
<p>The <strong>stage</strong> package implements the <strong>STAGE</strong> model (<strong>S</strong>tate <strong>T</strong>ransition <strong>A</strong>nalysis via <strong>G</strong>enerative <strong>E</strong>stimator), a Bayesian generative classifier for estimating <strong>transition points (m50)</strong> from two groups—at what value of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math> does <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math> become probable. An example is <em>length-at-maturity</em> problems, where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math> is binary maturity status, and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math> is a continuous measurement, such as length.</p>
<p>Existing methods for these sorts of applications have important limitations (see below), which the STAGE model overcomes.</p>
<p>Features of the STAGE model are:</p>
<ul>
<li>Each class is fit with a mixture distribution that combines a <strong>uniform plateau</strong> with a <strong>Gaussian tail</strong>
</li>
<li>Estimation of the transition point (<strong>m50</strong>) is based on the <strong>relative densities</strong> (Bayes’ rule) of the classes given <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>, not discriminative regression</li>
<li>A <strong>shared transition region</strong> centred at <strong>m50</strong> with width <strong>d</strong>.</li>
</ul>
<p>The goal is a model <strong>transition-point estimation</strong> that focuses inference on data in and around the transition point while being robust to unbalanced sample sizes.</p>
<p align="center">
<img src="reference/figures/stage_icon.png" width="500"></p>
<p>The process of testing the STAGE model against other methods is underway.</p>
<hr>
</div>
<div class="section level1">
<h1 id="package-features">Package features<a class="anchor" aria-label="anchor" href="#package-features"></a>
</h1>
<ul>
<li>
<code><a href="reference/fit_stage.html">fit_stage()</a></code> — fit STAGE model (single or multi-population)<br>
</li>
<li>
<code><a href="reference/transition_point.html">transition_point()</a></code> — summarise posteriors for <strong><em>m50</em></strong><br>
</li>
<li>
<code><a href="reference/predict.stage_fit.html">predict.stage_fit()</a></code> — predict class probabilities or labels<br>
</li>
<li>
<code><a href="reference/stage_priors.html">stage_priors()</a></code> — prior helper<br>
</li>
<li>
<code><a href="reference/get_cmdstan_model.html">get_cmdstan_model()</a></code> — internal CmdStan compiler helper</li>
</ul>
<p>Planned additions:</p>
<ul>
<li>Reparameterised logistic/HOF model<br>
</li>
<li>Bayesian LDA<br>
</li>
<li>Posterior predictive classification<br>
</li>
<li>Diagnostic + visualisation tools<br>
</li>
<li>Full vignette</li>
</ul>
<hr>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<p>You need <strong>cmdstanr</strong> + CmdStan installed:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"cmdstanr"</span>,</span>
<span>  repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"https://mc-stan.org/r-packages/"</span>, <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"repos"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">cmdstanr</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/cmdstanr/reference/install_cmdstan.html" class="external-link">install_cmdstan</a></span><span class="op">(</span><span class="op">)</span>   <span class="co"># run once</span></span></code></pre></div>
<p>Then install from GitHub:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"anhsmith/stage"</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level1">
<h1 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h1>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/anhsmith/stage" class="external-link">stage</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">L</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">U</span> <span class="op">&lt;-</span> <span class="fl">1500</span></span>
<span><span class="va">true_m50</span> <span class="op">&lt;-</span> <span class="fl">1250</span></span>
<span><span class="va">true_d</span>   <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span></span>
<span><span class="co"># simulate data</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">L</span>, <span class="va">U</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">true_m50</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">true_d</span> <span class="op">/</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fit STAGE model</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fit_stage.html">fit_stage</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, L <span class="op">=</span> <span class="va">L</span>, U <span class="op">=</span> <span class="va">U</span>, chains <span class="op">=</span> <span class="fl">2</span>, iter <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">fit</span></span></code></pre></div>
<p>Estimated transition point:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/transition_point.html">transition_point</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<p>Prediction:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">L</span>, <span class="va">U</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">p_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">x_grid</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x_grid</span>, <span class="va">p_hat</span>, type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"x"</span>, ylab <span class="op">=</span> <span class="st">"P(mature)"</span>, las <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level1">
<h1 id="hierarchical-model">
<strong>Hierarchical model</strong><a class="anchor" aria-label="anchor" href="#hierarchical-model"></a>
</h1>
<p>Multiple populations:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="st">"B"</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">N</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fit_stage.html">fit_stage</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, group <span class="op">=</span> <span class="va">group</span>, L <span class="op">=</span> <span class="va">L</span>, U <span class="op">=</span> <span class="va">U</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/transition_point.html">transition_point</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span></span></code></pre></div>
<p>This returns:</p>
<ul>
<li>global m50<br>
</li>
<li>group-specific m50_pop[j]</li>
</ul>
<hr>
</div>
<div class="section level1">
<h1 id="model-summary">
<strong>Model summary</strong><a class="anchor" aria-label="anchor" href="#model-summary"></a>
</h1>
<p>Each class is a <strong>uniform plateau</strong> with a <strong>Gaussian edge</strong>.<br>
Key parameters:</p>
<ul>
<li>
<code>m50</code> — transition centre<br>
</li>
<li>
<code>d</code> — width of transition region<br>
</li>
<li>
<code>sigma_x</code> — Gaussian spread</li>
</ul>
<p>Hierarchical structure:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode md"><code class="sourceCode markdown"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>m50_pop<span class="co">[</span><span class="ot">j</span><span class="co">]</span> = mu_m50 + z<span class="co">[</span><span class="ot">j</span><span class="co">]</span> * sigma_alpha</span></code></pre></div>
<p>(non-centred parameterisation for efficient sampling)</p>
<hr>
</div>
<div class="section level1">
<h1 id="development">
<strong>Development</strong><a class="anchor" aria-label="anchor" href="#development"></a>
</h1>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">test</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">document</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">build_readme</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level1">
<h1 id="license">
<strong>License</strong><a class="anchor" aria-label="anchor" href="#license"></a>
</h1>
<p>MIT © Adam N. H. Smith</p>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/anhsmith/stage/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/anhsmith/stage/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing stage</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Adam N. H. Smith <br><small class="roles"> Author, maintainer </small>   </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adam N. H. Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
